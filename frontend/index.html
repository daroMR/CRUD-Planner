<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planner Dashboard | Professional CRUD</title>
  <meta name="description" content="Dashboard profesional para la gesti√≥n de tareas de Microsoft Planner.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body class="dark-theme">
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <span>‚ú¶</span> Optisa Planner
    </div>

    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="switchSlide('slide-dashboard')" id="nav-dashboard">
        <span class="icon">üìä</span> Dashboard
      </div>
      <div class="nav-item" onclick="switchSlide('slide-admin')" id="nav-admin">
        <span class="icon">‚öôÔ∏è</span> Gesti√≥n
      </div>
      <div class="nav-item" onclick="switchSlide('slide-master')" id="nav-master">
        <span class="icon">üìú</span> Maestro
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-profile">
        <button id="loginBtn" class="btn btn-primary full-width" onclick="iniciarSesion()">
          üîë Conectar
        </button>
        <div id="userInfo"
          style="display: none; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 6px;">
          <span id="userName" class="badge">Usuario</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <header class="top-bar">
      <h2 id="current-slide-title">Vista General</h2>
      <div class="top-bar-actions">
        <button class="btn btn-primary" onclick="refreshAll()">
          <span class="icon">üîÑ</span> Sincronizar
        </button>
      </div>
    </header>

    <div class="slides-container">
      <!-- Slide 1: Dashboard -->
      <section id="slide-dashboard" class="slide active">
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <h2>Vista Jer√°rquica</h2>
              <span class="badge">GraphQL</span>
            </div>
            <div class="tree-viewer" style="height: calc(100% - 40px); overflow: auto;">
              <div id="resumenArbol" class="tree-structure"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2>JSON Raw</h2>
            </div>
            <pre id="resumenJson" class="code-block" style="height: calc(100% - 40px);"></pre>
          </div>
        </div>
      </section>

      <!-- Slide 2: Gesti√≥n -->
      <section id="slide-admin" class="slide">
        <div class="management-layout">
          <!-- Creation Forms -->
          <div class="card">
            <div class="card-header">
              <h2>Crear Entidades</h2>
            </div>
            <div class="tabs">
              <button class="tab-btn active" onclick="showTab('tab-plans')">Planes</button>
              <button class="tab-btn" onclick="showTab('tab-buckets')">Buckets</button>
              <button class="tab-btn" onclick="showTab('tab-tasks')">Tareas</button>
            </div>

            <div id="tab-plans" class="tab-content active">
              <div class="input-group">
                <input type="text" id="planName" placeholder="Nombre del Plan">
                <input type="text" id="planId" placeholder="ID (Manual, opcional)">
                <button class="btn btn-primary" onclick="crearPlan()">Crear Plan</button>
              </div>
            </div>

            <div id="tab-buckets" class="tab-content">
              <div class="input-group">
                <input type="text" id="bucketName" placeholder="Nombre Bucket">
                <input type="text" id="bucketId" placeholder="ID (Opcional)">
                <select id="bucketPlanId" class="select-input">
                  <option value="">Seleccionar Plan...</option>
                </select>
                <button class="btn btn-primary" onclick="crearBucket()">Crear Bucket</button>
              </div>
            </div>

            <div id="tab-tasks" class="tab-content">
              <div class="input-group">
                <input type="text" id="taskTitle" placeholder="T√≠tulo Tarea">
                <input type="text" id="taskId" placeholder="ID (Opcional)">
                <select id="taskPlanId" class="select-input"
                  onchange="updateBucketSelect('taskPlanId', 'taskBucketId')">
                  <option value="">Plan...</option>
                </select>
                <select id="taskBucketId" class="select-input">
                  <option value="">Bucket...</option>
                </select>
                <input type="number" id="taskPercent" placeholder="% Completado" value="0">
                <button class="btn btn-primary" onclick="crearTarea()">Crear Tarea</button>
              </div>
            </div>
          </div>

          <!-- Quick Actions / Update -->
          <div class="card">
            <div class="card-header">
              <h2>Actualizar & Eliminar</h2>
            </div>
            <div class="tabs">
              <button class="tab-btn active" onclick="showTab('edit-task')">Tarea</button>
              <button class="tab-btn" onclick="showTab('edit-bucket')">Bucket</button>
              <button class="tab-btn" onclick="showTab('edit-plan')">Plan</button>
            </div>

            <div id="edit-task" class="tab-content active">
              <div class="input-group">
                <select id="updateTaskId" class="select-input" onchange="fillTaskData()">
                  <option value="">Tarea...</option>
                </select>
                <input type="text" id="updateTaskTitle" placeholder="Nuevo T√≠tulo">
                <input type="number" id="updateTaskPercent" placeholder="%">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0.5rem;">
                  <select id="updateTaskPlanId" class="select-input"
                    onchange="updateBucketSelect('updateTaskPlanId', 'updateTaskBucketId')">
                    <option value="">Plan...</option>
                  </select>
                  <select id="updateTaskBucketId" class="select-input">
                    <option value="">Bucket...</option>
                  </select>
                </div>
                <div style="display:flex; gap:0.5rem;">
                  <button class="btn btn-primary" style="flex:1" onclick="actualizarTarea()">Actualizar</button>
                  <button class="btn btn-danger" onclick="eliminarTarea()">üóëÔ∏è</button>
                </div>
              </div>
              <div class="input-group"
                style="margin-top:1rem; border-top:1px solid var(--glass-border); padding-top:1rem;">
                <label>Borrar por ID Directo:</label>
                <div style="display:flex; gap:0.5rem;">
                  <input type="text" id="deleteTaskId" placeholder="ID Tarea">
                  <button class="btn btn-danger" onclick="eliminarTarea()">Eliminar</button>
                </div>
              </div>
            </div>

            <div id="edit-bucket" class="tab-content">
              <div class="input-group">
                <select id="manageBucketId" class="select-input" onchange="fillBucketData()">
                  <option value="">Bucket...</option>
                </select>
                <input type="text" id="manageBucketName" placeholder="Nuevo Nombre">
                <div style="display:flex; gap:0.5rem;">
                  <button class="btn btn-primary" style="flex:1" onclick="actualizarBucket()">Actualizar</button>
                  <button class="btn btn-danger" onclick="eliminarBucket()">Eliminar</button>
                </div>
              </div>
            </div>

            <div id="edit-plan" class="tab-content">
              <div class="input-group">
                <select id="managePlanId" class="select-input" onchange="fillPlanData()">
                  <option value="">Plan...</option>
                </select>
                <input type="text" id="managePlanName" placeholder="Nuevo Nombre">
                <div style="display:flex; gap:0.5rem;">
                  <button class="btn btn-primary" style="flex:1" onclick="actualizarPlan()">Actualizar</button>
                  <button class="btn btn-danger" onclick="eliminarPlan()">Eliminar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 3: Maestro -->
      <section id="slide-master" class="slide">
        <div class="card">
          <div class="card-header">
            <h2>Maestro de Datos</h2>
            <input type="text" id="masterSearch" placeholder="Filtrar..." oninput="renderMasterTable()"
              style="max-width:300px; margin-bottom:0;">
          </div>
          <div class="table-wrapper" style="height: calc(100% - 60px);">
            <table id="tablaMaestra">
              <thead>
                <tr>
                  <th>Plan</th>
                  <th>Bucket</th>
                  <th>T√≠tulo</th>
                  <th>%</th>
                  <th>IDs</th>
                </tr>
              </thead>
              <tbody id="masterTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Log at bottom -->
    <footer id="log" class="console-log"></footer>
  </main>

  <!-- Auth Modal (Mismo de antes) -->
  <div id="authModal" class="card glass-card"
    style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001; width: 350px;">
    <div class="card-header">
      <h2>Auth Microsoft</h2>
    </div>
    <div style="text-align: center; padding: 1rem;">
      <p style="font-size: 0.8rem; color: var(--text-muted);">Visita:</p>
      <a id="authUrl" href="#" target="_blank"
        style="color: var(--primary); font-weight: bold;">microsoft.com/devicelogin</a>
      <p style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">C√≥digo:</p>
      <div id="authCode"
        style="font-size: 1.5rem; font-weight: 800; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 8px; margin: 0.5rem 0;">
        XXXX-XXXX</div>
      <p id="authStatusMsg" style="font-size: 0.7rem;">Cargando...</p>
    </div>
  </div>
  <div id="modalOverlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 1000;">
  </div>

  <script src="app.js"></script>
</body>

</html>