<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planner Dashboard | Professional CRUD</title>
  <meta name="description" content="Dashboard profesional para la gesti贸n de tareas de Microsoft Planner.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body class="dark-theme">
  <header class="main-header">
    <div class="header-content">
      <h1 class="logo">Optisa Planner</h1>
      <nav class="main-nav">
        <button class="btn btn-primary" onclick="refreshAll()">
          <span class="icon"></span> Recargar Resumen
        </button>
      </nav>
    </div>
  </header>

  <main class="dashboard-container">
    <!-- Resumen Section -->
    <section class="card glass-card resumen-section">
      <div class="card-header">
        <div class="user-profile">
          <button id="loginBtn" class="btn btn-primary" onclick="iniciarSesion()">
            <span class="icon"></span> Conectar Planner
          </button>
          <div id="userInfo" style="display: none;">
            <span id="userName" class="badge">Usuario</span>
          </div>
        </div>
        <h2>Resumen General</h2>
        <span class="badge">GraphQL</span>
      </div>
      <div class="split-view">
        <div class="json-viewer">
          <h3>JSON Raw</h3>
          <pre id="resumenJson" class="code-block"></pre>
        </div>
        <div class="tree-viewer">
          <h3>Vista Jer谩rquica</h3>
          <div id="resumenArbol" class="tree-structure"></div>
        </div>
      </div>
    </section>

    <!-- Management Grid -->
    <div class="management-grid">
      <!-- Create Section -->
      <section class="card glass-card creation-panel">
        <div class="card-header">
          <h2>Gesti贸n de Entidades</h2>
        </div>

        <div class="tab-container">
          <div class="tabs">
            <button class="tab-btn active" onclick="showTab('tab-plans')">Planes</button>
            <button class="tab-btn" onclick="showTab('tab-buckets')">Buckets</button>
            <button class="tab-btn" onclick="showTab('tab-tasks')">Tareas</button>
          </div>

          <div id="tab-plans" class="tab-content active">
            <div class="input-group">
              <input type="text" id="planName" placeholder="Nombre del Plan">
              <input type="text" id="planId" placeholder="ID (Manual, opcional)">
              <button class="btn btn-action" onclick="crearPlan()">Crear Plan</button>
            </div>
          </div>

          <div id="tab-buckets" class="tab-content">
            <div class="input-group">
              <input type="text" id="bucketName" placeholder="Nombre Bucket">
              <input type="text" id="bucketId" placeholder="ID (Opcional)">
              <select id="bucketPlanId" class="select-input">
                <option value="">Seleccionar Plan...</option>
              </select>
              <button class="btn btn-action" onclick="crearBucket()">Crear Bucket</button>
            </div>
          </div>

          <div id="tab-tasks" class="tab-content">
            <div class="input-group">
              <input type="text" id="taskTitle" placeholder="T铆tulo Tarea">
              <input type="text" id="taskId" placeholder="ID (Opcional)">
              <select id="taskPlanId" class="select-input" onchange="updateBucketSelect('taskPlanId', 'taskBucketId')">
                <option value="">Seleccionar Plan...</option>
              </select>
              <select id="taskBucketId" class="select-input">
                <option value="">Seleccionar Bucket...</option>
              </select>
              <input type="number" id="taskPercent" placeholder="% Completado" value="0">
              <button class="btn btn-action" onclick="crearTarea()">Crear Tarea</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Update/Delete Panel -->
      <section class="card glass-card update-panel">
        <div class="card-header">
          <h2>Acciones R谩pidas</h2>
        </div>
        <div class="action-grid">
          <div class="action-item">
            <h3>Gesti贸n de Planes</h3>
            <div class="row">
              <select id="managePlanId" class="select-input full-width" onchange="fillPlanData()">
                <option value="">Seleccionar Plan...</option>
              </select>
              <input type="text" id="managePlanName" placeholder="Nuevo Nombre">
            </div>
            <div class="button-group">
              <button class="btn btn-secondary" onclick="actualizarPlan()">Actualizar</button>
              <button class="btn btn-danger" onclick="eliminarPlan()">Eliminar</button>
            </div>
          </div>

          <div class="action-item">
            <h3>Gesti贸n de Buckets</h3>
            <div class="row">
              <select id="manageBucketId" class="select-input full-width" onchange="fillBucketData()">
                <option value="">Seleccionar Bucket...</option>
              </select>
              <input type="text" id="manageBucketName" placeholder="Nuevo Nombre">
            </div>
            <select id="manageBucketPlanId" class="select-input full-width">
              <option value="">Plan Asociado (Opcional)...</option>
            </select>
            <div class="button-group">
              <button class="btn btn-secondary" onclick="actualizarBucket()">Actualizar</button>
              <button class="btn btn-danger" onclick="eliminarBucket()">Eliminar</button>
            </div>
          </div>

          <div class="action-item">
            <h3>Actualizar Tarea</h3>
            <select id="updateTaskId" class="select-input full-width" onchange="fillTaskData()">
              <option value="">Seleccionar Tarea...</option>
            </select>
            <input type="text" id="updateTaskTitle" placeholder="Nuevo T铆tulo">
            <input type="number" id="updateTaskPercent" placeholder="%">
            <div class="row">
              <select id="updateTaskPlanId" class="select-input"
                onchange="updateBucketSelect('updateTaskPlanId', 'updateTaskBucketId')">
                <option value="">Plan...</option>
              </select>
              <select id="updateTaskBucketId" class="select-input">
                <option value="">Bucket...</option>
              </select>
            </div>
            <button class="btn btn-secondary full-width" onclick="actualizarTarea()">Actualizar</button>
          </div>
          <div class="action-item">
            <h3>Eliminar Tarea</h3>
            <select id="deleteTaskId" class="select-input full-width">
              <option value="">Seleccionar Tarea...</option>
            </select>
            <button class="btn btn-danger full-width" onclick="eliminarTarea()">Eliminar</button>
          </div>
        </div>
      </section>
    </div>

    <!-- Data Tables -->
    <section class="card glass-card data-section">
      <div class="card-header">
        <h2>Explorador de Datos</h2>
        <div class="table-controls">
          <button class="btn btn-small" onclick="listarPlanes()">Planes</button>
          <button class="btn btn-small" onclick="listarBuckets()">Buckets</button>
          <button class="btn btn-small" onclick="listarTareas()">Tareas</button>
        </div>
      </div>

      <div class="tables-container">
        <div id="wrapperPlanes" class="table-wrapper">
          <h3>Planes</h3>
          <input type="text" id="filtroPlan" class="filter-input" placeholder="Filtrar por nombre..."
            oninput="listarPlanes()">
          <table id="tablaPlanes">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="wrapperBuckets" class="table-wrapper">
          <h3>Buckets</h3>
          <div class="filter-row">
            <input type="text" id="filtroBucket" class="filter-input" placeholder="Nombre..." oninput="listarBuckets()">
            <input type="text" id="filtroBucketPlanId" class="filter-input small" placeholder="Plan ID..."
              oninput="listarBuckets()">
          </div>
          <table id="tablaBuckets">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Plan ID</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="wrapperTareas" class="table-wrapper scrollable">
          <h3>Tareas</h3>
          <div class="filter-row">
            <input type="text" id="filtroTarea" class="filter-input" placeholder="T铆tulo..." oninput="listarTareas()">
            <input type="text" id="filtroTareaBucketId" class="filter-input small" placeholder="B. ID..."
              oninput="listarTareas()">
            <input type="text" id="filtroTareaPlanId" class="filter-input small" placeholder="P. ID..."
              oninput="listarTareas()">
          </div>
          <table id="tablaTareas">
            <thead>
              <tr>
                <th>ID</th>
                <th>T铆tulo</th>
                <th>%</th>
                <th>Bucket</th>
                <th>Plan</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <footer class="main-footer">
    <div id="log" class="console-log"></div>
  </footer>

  <!-- Auth Modal -->
  <div id="authModal" class="glass-card"
    style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; padding: 2rem; max-width: 400px; width: 90%;">
    <div class="card-header">
      <h2>Autenticaci贸n Microsoft</h2>
    </div>
    <div style="text-align: center;">
      <p>Para conectar tu Planner, por favor visita:</p>
      <a id="authUrl" href="#" target="_blank"
        style="color: var(--primary); font-weight: bold; margin: 1rem 0; display: block;">microsoft.com/devicelogin</a>
      <p>E introduce el siguiente c贸digo:</p>
      <div id="authCode"
        style="font-size: 2rem; font-weight: 800; letter-spacing: 0.2em; margin: 1.5rem 0; background: rgba(0,0,0,0.3); padding: 0.5rem; border-radius: 8px;">
        XXXX-XXXX</div>
      <p id="authStatusMsg" style="color: var(--text-muted); font-size: 0.8rem;">Esperando inicio de sesi贸n...</p>
    </div>
  </div>
  <div id="modalOverlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 999;">
  </div>

  <script src="app.js"></script>
  <script>
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.currentTarget.classList.add('active');
    }
  </script>
</body>

</html>