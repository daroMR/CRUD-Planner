<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planner Dashboard | Professional CRUD</title>
  <meta name="description" content="Dashboard profesional para la gesti√≥n de tareas de Microsoft Planner.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body class="dark-theme">
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <span>‚ú¶</span> Optisa Planner
    </div>

    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="switchSlide('slide-dashboard')" id="nav-dashboard">
        <span class="icon">üìä</span> Dashboard
      </div>
      <div class="nav-item" onclick="switchSlide('slide-admin')" id="nav-admin">
        <span class="icon">‚öôÔ∏è</span> Gesti√≥n
      </div>
      <div class="nav-item" onclick="switchSlide('slide-master')" id="nav-master">
        <span class="icon">üìú</span> Maestro
      </div>
      <div class="nav-item" onclick="switchSlide('slide-info')" id="nav-info">
        <span class="icon">üìñ</span> Documentaci√≥n
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-profile">
        <button id="loginBtn" class="btn btn-primary full-width" onclick="iniciarSesion()">
          üîë Conectar
        </button>
        <div id="userInfo"
          style="display: none; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 6px;">
          <span id="userName" class="badge">Usuario</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <header class="top-bar">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
        <h2 id="current-slide-title">Vista General</h2>
      </div>
      <div class="top-bar-actions">
        <button class="btn btn-primary" onclick="refreshAll()">
          <span class="icon">üîÑ</span> <span>Sincronizar</span>
        </button>
      </div>
    </header>

    <div class="slides-container">
      <!-- Slide 1: Dashboard -->
      <section id="slide-dashboard" class="slide active">
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <h2>Vista Jer√°rquica</h2>
              <span class="badge">GraphQL</span>
            </div>
            <div class="tree-viewer" style="height: calc(100% - 40px); overflow: auto;">
              <div id="resumenArbol" class="tree-structure"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2>JSON Raw</h2>
            </div>
            <pre id="resumenJson" class="code-block" style="height: calc(100% - 40px);"></pre>
          </div>
        </div>
      </section>

      <!-- Slide 2: Gesti√≥n -->
      <section id="slide-admin" class="slide">
        <div class="management-layout">
          <!-- Creation Forms -->
          <div class="card">
            <div class="card-header">
              <div>
                <h2>‚ûï Nueva Entidad</h2>
                <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">Crea planes, buckets o
                  tareas vac√≠as.</p>
              </div>
            </div>
            <div class="tabs">
              <button class="tab-btn active" onclick="showTab('tab-plans')">Planes</button>
              <button class="tab-btn" onclick="showTab('tab-buckets')">Buckets</button>
              <button class="tab-btn" onclick="showTab('tab-tasks')">Tareas</button>
            </div>

            <div id="tab-plans" class="tab-content active">
              <div class="input-group">
                <label style="font-size: 0.7rem; color: var(--text-muted);">Nombre del proyecto:</label>
                <input type="text" id="planName" placeholder="Ej: Lanzamiento Q3">
                <input type="text" id="planId" placeholder="ID Manual (opcional)">
                <button class="btn btn-primary" onclick="crearPlan()">Crear Plan</button>
              </div>
            </div>

            <div id="tab-buckets" class="tab-content">
              <div class="input-group">
                <label style="font-size: 0.7rem; color: var(--text-muted);">Contenedor de tareas:</label>
                <input type="text" id="bucketName" placeholder="Ej: Por hacer, En curso">
                <select id="bucketPlanId" class="select-input">
                  <option value="">Seleccionar Plan Destino...</option>
                </select>
                <button class="btn btn-primary" onclick="crearBucket()">Crear Bucket</button>
              </div>
            </div>

            <div id="tab-tasks" class="tab-content">
              <div class="input-group">
                <label style="font-size: 0.7rem; color: var(--text-muted);">Detalles de la tarea:</label>
                <input type="text" id="taskTitle" placeholder="Ej: Dise√±ar mockup">
                <select id="taskPlanId" class="select-input"
                  onchange="updateBucketSelect('taskPlanId', 'taskBucketId')">
                  <option value="">1. Seleccionar Plan...</option>
                </select>
                <select id="taskBucketId" class="select-input">
                  <option value="">2. Seleccionar Bucket...</option>
                </select>
                <div style="display:flex; align-items:center; gap:0.5rem;">
                  <span style="font-size: 0.7rem; color: var(--text-muted); white-space:nowrap;">Progreso:</span>
                  <input type="number" id="taskPercent" placeholder="%" value="0" style="flex:1;">
                </div>
                <button class="btn btn-primary" onclick="crearTarea()">Crear Tarea</button>
              </div>
            </div>
          </div>

          <!-- Quick Actions / Update -->
          <div class="card">
            <div class="card-header">
              <div>
                <h2>‚úèÔ∏è Edici√≥n & Control</h2>
                <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">Modifica o elimina
                  elementos existentes.</p>
              </div>
            </div>
            <div class="tabs">
              <button class="tab-btn active" onclick="showTab('edit-task')">Tareas</button>
              <button class="tab-btn" onclick="showTab('edit-bucket')">Buckets</button>
              <button class="tab-btn" onclick="showTab('edit-plan')">Planes</button>
            </div>

            <div id="edit-task" class="tab-content active">
              <div class="input-group">
                <label style="font-size: 0.7rem; color: var(--text-muted);">Buscar tarea para editar:</label>
                <select id="updateTaskId" class="select-input" onchange="fillTaskData()">
                  <option value="">Seleccionar Tarea...</option>
                </select>
                <input type="text" id="updateTaskTitle" placeholder="Cambiar t√≠tulo">
                <div style="display:flex; align-items:center; gap:0.5rem;">
                  <span style="font-size: 0.7rem; color: var(--text-muted); white-space:nowrap;">Nuevo %:</span>
                  <input type="number" id="updateTaskPercent" placeholder="%" style="flex:1;">
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0.5rem;">
                  <select id="updateTaskPlanId" class="select-input"
                    onchange="updateBucketSelect('updateTaskPlanId', 'updateTaskBucketId')">
                    <option value="">Mover a Plan...</option>
                  </select>
                  <select id="updateTaskBucketId" class="select-input">
                    <option value="">Mover a Bucket...</option>
                  </select>
                </div>
                <div style="display:flex; gap:0.5rem;">
                  <button class="btn btn-primary" style="flex:1" onclick="actualizarTarea()">Actualizar Tarea</button>
                </div>
              </div>
              <div class="input-group"
                style="margin-top:1rem; border-top:1px solid var(--glass-border); padding-top:1rem;">
                <label style="font-size: 0.7rem; color: var(--danger);">Zona Peligrosa (Eliminar):</label>
                <div style="display:flex; gap:0.5rem;">
                  <select id="deleteTaskId" class="select-input" style="flex:1;">
                    <option value="">Seleccionar Tarea a eliminar...</option>
                  </select>
                  <button class="btn btn-danger" onclick="eliminarTarea()">Eliminar</button>
                </div>
              </div>
            </div>

            <div id="edit-bucket" class="tab-content">
              <div class="input-group">
                <label style="font-size: 0.7rem; color: var(--text-muted);">Editar Bucket:</label>
                <select id="manageBucketId" class="select-input" onchange="fillBucketData()">
                  <option value="">Seleccionar Bucket...</option>
                </select>
                <input type="text" id="manageBucketName" placeholder="Nuevo nombre del Bucket">
                <select id="manageBucketPlanId" class="select-input">
                  <option value="">Cambiar Plan Asociado...</option>
                </select>
                <div style="display:flex; gap:0.5rem;">
                  <button class="btn btn-primary" style="flex:1" onclick="actualizarBucket()">Actualizar</button>
                  <button class="btn btn-danger" onclick="eliminarBucket()">Eliminar</button>
                </div>
              </div>
            </div>

            <div id="edit-plan" class="tab-content">
              <div class="input-group">
                <label style="font-size: 0.7rem; color: var(--text-muted);">Editar Plan:</label>
                <select id="managePlanId" class="select-input" onchange="fillPlanData()">
                  <option value="">Seleccionar Plan...</option>
                </select>
                <input type="text" id="managePlanName" placeholder="Nuevo nombre del Plan">
                <div style="display:flex; gap:0.5rem;">
                  <button class="btn btn-primary" style="flex:1" onclick="actualizarPlan()">Actualizar</button>
                  <button class="btn btn-danger" onclick="eliminarPlan()">Eliminar</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Helper Tips -->
          <div class="card" style="grid-column: 1 / -1; height: auto;">
            <div class="card-header">
              <h2>üí° Gu√≠a R√°pida de Gesti√≥n</h2>
            </div>
            <div
              style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; font-size: 0.8rem; color: var(--text-muted);">
              <div>
                <strong style="color: var(--primary);">1. Jerarqu√≠a</strong>
                <p>Plan (Proyecto) > Bucket (Contenedor) > Tarea (Acci√≥n).</p>
              </div>
              <div>
                <strong style="color: var(--accent);">2. Creaci√≥n</strong>
                <p>Para crear una tarea, primero selecciona el Plan y luego el Bucket destino.</p>
              </div>
              <div>
                <strong style="color: var(--primary-hover);">3. Edici√≥n</strong>
                <p>Selecciona una tarea para cargar sus datos. Puedes moverla de Plan o Bucket desde all√≠.</p>
              </div>
              <div>
                <strong style="color: var(--danger);">4. Eliminaci√≥n</strong>
                <p>Borrar un Plan eliminar√° todos sus Buckets y Tareas asociados.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 3: Maestro -->
      <section id="slide-master" class="slide">
        <div class="card">
          <div class="card-header">
            <h2>Maestro de Datos</h2>
            <input type="text" id="masterSearch" placeholder="Filtrar..." oninput="renderMasterTable()"
              style="max-width:300px; margin-bottom:0;">
          </div>
          <div class="table-wrapper" style="height: calc(100% - 60px);">
            <table id="tablaMaestra">
              <thead>
                <tr>
                  <th>Plan</th>
                  <th>Bucket</th>
                  <th>T√≠tulo</th>
                  <th>%</th>
                  <th>IDs</th>
                </tr>
              </thead>
              <tbody id="masterTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Slide 4: Documentaci√≥n (Info & Docs) -->
      <section id="slide-info" class="slide">
        <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr;">
          <div class="card">
            <div class="card-header">
              <h2>üìê Arquitectura (Pilares)</h2>
              <span class="badge">Docs</span>
            </div>
            <div class="input-group" style="gap: 1rem;">
              <a href="/docs/pilar1-ecosistema.md" target="_blank" class="nav-item">
                <span class="icon">üèóÔ∏è</span> Pilar 1: Ecosistema T√©cnico
              </a>
              <a href="/docs/pilar2-flujo-datos.md" target="_blank" class="nav-item">
                <span class="icon">üîÑ</span> Pilar 2: Flujo de Datos & Sync
              </a>
              <a href="/docs/pilar3-api-contratos.md" target="_blank" class="nav-item">
                <span class="icon">üîå</span> Pilar 3: API & Contratos
              </a>
              <a href="/docs/pilar4-adr.md" target="_blank" class="nav-item">
                <span class="icon">‚öñÔ∏è</span> Pilar 4: Decisiones (ADR)
              </a>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>üöÄ Estrategia (Info)</h2>
              <span class="badge">Master</span>
            </div>
            <div class="input-group" style="gap: 1rem;">
              <a href="/info/onboarding.md" target="_blank" class="nav-item">
                <span class="icon">‚úàÔ∏è</span> Onboarding Estrat√©gico
              </a>
              <a href="/info/golden-thread.svg" target="_blank" class="nav-item">
                <span class="icon">üßµ</span> The Golden Thread (SVG Map)
              </a>
              <a href="/info/blueprint.d2" target="_blank" class="nav-item">
                <span class="icon">üèõÔ∏è</span> Master Blueprint (D2)
              </a>
              <div
                style="margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center;">
                <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">Visualizaci√≥n R√°pida:
                </p>
                <img src="/info/golden-thread2.png"
                  style="width: 100%; border-radius: 4px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Log at bottom -->
    <footer id="log" class="console-log"></footer>
  </main>

  <!-- Auth Modal (Mismo de antes) -->
  <div id="authModal" class="card glass-card"
    style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001; width: 350px;">
    <div class="card-header">
      <h2>Auth Microsoft</h2>
    </div>
    <div style="text-align: center; padding: 1rem;">
      <p style="font-size: 0.8rem; color: var(--text-muted);">Visita:</p>
      <a id="authUrl" href="#" target="_blank"
        style="color: var(--primary); font-weight: bold;">microsoft.com/devicelogin</a>
      <p style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">C√≥digo:</p>
      <div id="authCode"
        style="font-size: 1.5rem; font-weight: 800; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 8px; margin: 0.5rem 0;">
        XXXX-XXXX</div>
      <p id="authStatusMsg" style="font-size: 0.7rem;">Cargando...</p>
    </div>
  </div>
  <div id="modalOverlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 1000;">
  </div>

  <script src="app.js"></script>
</body>

</html>